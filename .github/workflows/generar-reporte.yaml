name: Generar Informe de Fallas ğŸ“ƒ

# Cuando quiero que se ejecute el flujo de trabajo
on:
  # Por tiempo
  #schedule:
    # Cada 30 segundos, por ejemplo
    #- cron: '*/30 * * * *'
  push:
    branches:
      - main

# Los pasos que se ejecutarÃ¡n para realizar una tarea
jobs:
  # En dÃ³nde se ejecutarÃ¡ el flujo de trabajo
  Generador-de-Reportes:
    name: MÃ¡quina Virtual de Ubuntu ğŸ§
    runs-on: ubuntu-latest

    # Permisos para hacer commit y push
    permissions:
      contents: write

    # Como se ejecutarÃ¡ el flujo de trabajo
    steps:
      - name: Leyendo el repositorio ğŸ‘€
        uses: actions/checkout@v4
      
      - name: Configurando Java 17 ğŸ“¦
        uses: actions/setup-java@v4
        with:
          distribution: 'oracle'
          java-version: '17'
      
      - name: Ejecutar aplicaciÃ³n de Spring Boot ğŸƒ
        run: mvn spring-boot:run &
        # Esperar a que la aplicaciÃ³n estÃ© disponible en el puerto 8080
        timeout-minutes: 1
      
      - name: Esperar a que el endpoint estÃ© disponible ğŸ•’
        uses: emilioschepis/wait-for-endpoint@v1.0.3
        with:
          url: http://localhost:8080/generar-informe
          method: POST

      - name: Realizar solicitud HTTP ğŸŒ
        run: |
          curl -X POST http://localhost:8080/generar-informe
        
      - name: Realizar commit y push de cambios ğŸ“¤
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: Add report file ğŸ“ƒ
          commit_user_name: Esteban [GitActions]